/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.mycompany.findvulnerability;
import java.util.Arrays;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
/**
 *
 * @author Fatemeh Saligheh
 */
@SpringBootApplication
public class Main implements ApplicationRunner {
    private static final Logger logger = LoggerFactory.getLogger(Main.class);
    
    public static void main(String[] args) {
		SpringApplication.run(Main.class, args);
	}
    
    @Override
    public void run(ApplicationArguments args) throws Exception {
            logger.info("Command-line arguments: {}", Arrays.toString(args.getSourceArgs()));
            logger.info("Non Option Args: {}", args.getNonOptionArgs());
            logger.info("Option Names: {}", args.getOptionNames());
    boolean hasInput = false;
    boolean hasImport = false;
    String inputFile = "";
    String neo4jImport = "";
    for (String name : args.getOptionNames()){
//        logger.info("arg-" + name + "=" + args.getOptionValues(name));
         if(name.equalsIgnoreCase("input")){
             hasInput = true;
             inputFile = args.getOptionValues(name).get(0);
             logger.info(args.getOptionValues(name).get(0));
         }
         if(name.equalsIgnoreCase("neo4jImport")){
             hasImport = true;
             neo4jImport = args.getOptionValues(name).get(0);
             logger.info(args.getOptionValues(name).get(0));
         }    
    }
    
    if(hasInput){
        if(hasImport){
            System.out.println("hello neo4j");
            try (Execute neo4j = new Execute("bolt://localhost:7687", "neo4j", "fatemeh110")) {
                neo4j.findVulner(inputFile,neo4jImport);
            }
        }else{
           logger.info("cant recognize Neo4j import file path"); 
        }
    }else{
        logger.info("cant recognize input path"); 
    }
    }
}
